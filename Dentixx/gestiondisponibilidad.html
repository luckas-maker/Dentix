<!DOCTYPE html>
<html lang="es" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gesti√≥n de Disponibilidad - Agenda Dental</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            box-sizing: border-box;
        }
        .time-slot {
            transition: all 0.2s ease;
        }
        .time-slot:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        .available-slot {
            background: linear-gradient(135deg, #10b981, #059669);
        }
        .unavailable-slot {
            background: linear-gradient(135deg, #ef4444, #dc2626);
        }
    </style>
</head>
<body class="h-full bg-gradient-to-br from-blue-50 to-indigo-100 font-sans">
    <div class="min-h-full p-6">
        <!-- Header -->
        <div class="max-w-7xl mx-auto mb-8">
            <div class="bg-white rounded-2xl shadow-lg p-6 border border-blue-100">
                <div class="flex items-center justify-between">
                    <div>
                        <h1 class="text-3xl font-bold text-gray-800 mb-2">ü¶∑ Gesti√≥n de Disponibilidad</h1>
                        <p class="text-gray-600">Configure sus horarios disponibles para atender pacientes</p>
                    </div>
                    <div class="text-right">
                        <div class="text-sm text-gray-500">Fecha actual</div>
                        <div class="text-lg font-semibold text-blue-600" id="currentDate"></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="max-w-7xl mx-auto grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Calendar Section -->
            <div>
                <div class="bg-white rounded-2xl shadow-lg p-6 border border-blue-100">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-xl font-bold text-gray-800">üìÖ Calendario</h2>
                        <div class="flex items-center space-x-4">
                            <button onclick="previousMonth()" class="p-2 rounded-lg bg-blue-100 hover:bg-blue-200 text-blue-600 transition-colors">
                                ‚Üê
                            </button>
                            <span class="font-semibold text-gray-700" id="monthYear"></span>
                            <button onclick="nextMonth()" class="p-2 rounded-lg bg-blue-100 hover:bg-blue-200 text-blue-600 transition-colors">
                                ‚Üí
                            </button>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-7 gap-2 mb-4">
                        <div class="text-center font-semibold text-gray-600 py-2">Dom</div>
                        <div class="text-center font-semibold text-gray-600 py-2">Lun</div>
                        <div class="text-center font-semibold text-gray-600 py-2">Mar</div>
                        <div class="text-center font-semibold text-gray-600 py-2">Mi√©</div>
                        <div class="text-center font-semibold text-gray-600 py-2">Jue</div>
                        <div class="text-center font-semibold text-gray-600 py-2">Vie</div>
                        <div class="text-center font-semibold text-gray-600 py-2">S√°b</div>
                    </div>
                    
                    <div class="grid grid-cols-7 gap-2" id="calendarGrid">
                        <!-- Calendar days will be generated here -->
                    </div>
                </div>
            </div>

            <!-- Time Slots Configuration -->
            <div class="space-y-6">
                <!-- Selected Date Info -->
                <div class="bg-white rounded-2xl shadow-lg p-4 border border-blue-100">
                    <h3 class="text-lg font-bold text-gray-800 mb-3">üìã Fecha Seleccionada</h3>
                    <div class="text-center p-3 bg-blue-50 rounded-lg">
                        <div class="text-xl font-bold text-blue-600" id="selectedDate">Seleccione una fecha</div>
                    </div>
                </div>

                <!-- Quick Time Slots -->
                <div class="bg-white rounded-2xl shadow-lg p-4 border border-blue-100">
                    <h3 class="text-lg font-bold text-gray-800 mb-3">‚è∞ Configuraci√≥n R√°pida</h3>
                    
                    <div class="space-y-3">
                        <div class="grid grid-cols-2 gap-3">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Inicio</label>
                                <input type="time" id="startTime" value="08:00" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Fin</label>
                                <input type="time" id="endTime" value="17:00" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Duraci√≥n (min)</label>
                            <select id="slotDuration" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                <option value="30">30 minutos</option>
                                <option value="45">45 minutos</option>
                                <option value="60">60 minutos</option>
                                <option value="90">90 minutos</option>
                            </select>
                        </div>
                        
                        <button onclick="generateTimeSlots()" class="w-full bg-gradient-to-r from-blue-600 to-blue-700 text-white py-2 px-4 rounded-lg font-semibold hover:from-blue-700 hover:to-blue-800 transition-all transform hover:scale-105">
                            Generar Horarios
                        </button>
                    </div>
                </div>

                <!-- Available Time Slots -->
                <div class="bg-white rounded-2xl shadow-lg p-4 border border-blue-100">
                    <div class="flex items-center justify-between mb-3">
                        <h3 class="text-lg font-bold text-gray-800">üïê Horarios del D√≠a</h3>
                        <div class="flex space-x-2">
                            <button onclick="addCustomSlot()" class="px-2 py-1 bg-green-600 text-white text-xs rounded-lg hover:bg-green-700 transition-colors">
                                + Agregar
                            </button>
                            <button onclick="clearAllSlots()" class="px-2 py-1 bg-red-600 text-white text-xs rounded-lg hover:bg-red-700 transition-colors">
                                üóëÔ∏è Limpiar
                            </button>
                        </div>
                    </div>
                    <div id="timeSlotsList" class="space-y-2 max-h-96 overflow-y-auto">
                        <div class="text-center text-gray-500 py-8">
                            Seleccione una fecha para ver los horarios
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentDate = new Date();
        let selectedDateStr = '';
        let availabilityData = {};

        // Initialize the calendar
        function initCalendar() {
            updateCurrentDate();
            generateCalendar();
        }

        function updateCurrentDate() {
            const today = new Date();
            document.getElementById('currentDate').textContent = today.toLocaleDateString('es-ES', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }

        function generateCalendar() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            
            document.getElementById('monthYear').textContent = currentDate.toLocaleDateString('es-ES', {
                month: 'long',
                year: 'numeric'
            });

            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const startDate = new Date(firstDay);
            startDate.setDate(startDate.getDate() - firstDay.getDay());

            const calendarGrid = document.getElementById('calendarGrid');
            calendarGrid.innerHTML = '';

            for (let i = 0; i < 42; i++) {
                const date = new Date(startDate);
                date.setDate(startDate.getDate() + i);
                
                const dayElement = document.createElement('div');
                const dateStr = date.toISOString().split('T')[0];
                const isCurrentMonth = date.getMonth() === month;
                const isToday = date.toDateString() === new Date().toDateString();
                const hasAvailability = availabilityData[dateStr] && availabilityData[dateStr].length > 0;
                
                dayElement.className = `
                    p-3 text-center cursor-pointer rounded-lg transition-all hover:scale-105
                    ${isCurrentMonth ? 'text-gray-800' : 'text-gray-400'}
                    ${isToday ? 'bg-blue-600 text-white font-bold' : 'hover:bg-blue-100'}
                    ${hasAvailability ? 'border-2 border-green-400' : ''}
                    ${selectedDateStr === dateStr ? 'ring-2 ring-blue-500 bg-blue-50' : ''}
                `;
                
                dayElement.textContent = date.getDate();
                dayElement.onclick = () => selectDate(dateStr, date);
                
                if (hasAvailability) {
                    const indicator = document.createElement('div');
                    indicator.className = 'w-2 h-2 bg-green-500 rounded-full mx-auto mt-1';
                    dayElement.appendChild(indicator);
                }
                
                calendarGrid.appendChild(dayElement);
            }
        }

        function selectDate(dateStr, date) {
            selectedDateStr = dateStr;
            document.getElementById('selectedDate').textContent = date.toLocaleDateString('es-ES', {
                weekday: 'long',
                day: 'numeric',
                month: 'long',
                year: 'numeric'
            });
            generateCalendar();
            displayTimeSlots();
        }

        function previousMonth() {
            currentDate.setMonth(currentDate.getMonth() - 1);
            generateCalendar();
        }

        function nextMonth() {
            currentDate.setMonth(currentDate.getMonth() + 1);
            generateCalendar();
        }

        function generateTimeSlots() {
            if (!selectedDateStr) {
                alert('Por favor seleccione una fecha primero');
                return;
            }

            const startTime = document.getElementById('startTime').value;
            const endTime = document.getElementById('endTime').value;
            const duration = parseInt(document.getElementById('slotDuration').value);

            if (!startTime || !endTime) {
                alert('Por favor complete los horarios de inicio y fin');
                return;
            }

            const slots = [];
            const start = new Date(`2000-01-01T${startTime}:00`);
            const end = new Date(`2000-01-01T${endTime}:00`);

            let current = new Date(start);
            while (current < end) {
                const timeStr = current.toTimeString().slice(0, 5);
                slots.push({
                    time: timeStr,
                    available: true
                });
                current.setMinutes(current.getMinutes() + duration);
            }

            availabilityData[selectedDateStr] = slots;
            generateCalendar();
            displayTimeSlots();
        }

        function displayTimeSlots() {
            const container = document.getElementById('timeSlotsList');
            
            if (!selectedDateStr || !availabilityData[selectedDateStr]) {
                container.innerHTML = '<div class="text-center text-gray-500 py-8">No hay horarios configurados para esta fecha</div>';
                return;
            }

            const slots = availabilityData[selectedDateStr];
            container.innerHTML = slots.map((slot, index) => `
                <div class="time-slot p-3 rounded-lg ${slot.available ? 'available-slot text-white' : 'unavailable-slot text-white'}" 
                     id="slot-${index}">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-2">
                            <span class="font-semibold">${slot.time}</span>
                            <span class="text-sm">${slot.available ? '‚úÖ Disponible' : '‚ùå No disponible'}</span>
                        </div>
                        <div class="flex items-center space-x-2">
                            <button onclick="editSlot(${index})" class="p-1 hover:bg-white hover:bg-opacity-20 rounded transition-colors" title="Editar">
                                ‚úèÔ∏è
                            </button>
                            <button onclick="toggleSlot('${slot.time}')" class="p-1 hover:bg-white hover:bg-opacity-20 rounded transition-colors" title="Cambiar estado">
                                üîÑ
                            </button>
                            <button onclick="deleteSlot(${index})" class="p-1 hover:bg-white hover:bg-opacity-20 rounded transition-colors" title="Eliminar">
                                üóëÔ∏è
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function toggleSlot(time) {
            if (!availabilityData[selectedDateStr]) return;
            
            const slot = availabilityData[selectedDateStr].find(s => s.time === time);
            if (slot) {
                slot.available = !slot.available;
                displayTimeSlots();
                generateCalendar();
            }
        }

        function deleteSlot(index) {
            if (!availabilityData[selectedDateStr]) return;
            
            if (confirm('¬øEst√° seguro de que desea eliminar este horario?')) {
                availabilityData[selectedDateStr].splice(index, 1);
                displayTimeSlots();
                generateCalendar();
            }
        }

        function editSlot(index) {
            if (!availabilityData[selectedDateStr]) return;
            
            const slot = availabilityData[selectedDateStr][index];
            const newTime = prompt('Ingrese el nuevo horario (formato HH:MM):', slot.time);
            
            if (newTime && /^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/.test(newTime)) {
                // Verificar que no exista otro horario igual
                const exists = availabilityData[selectedDateStr].some((s, i) => s.time === newTime && i !== index);
                if (exists) {
                    alert('Ya existe un horario con esa hora');
                    return;
                }
                
                slot.time = newTime;
                // Reordenar los horarios
                availabilityData[selectedDateStr].sort((a, b) => a.time.localeCompare(b.time));
                displayTimeSlots();
                generateCalendar();
            } else if (newTime) {
                alert('Formato de hora inv√°lido. Use HH:MM (ejemplo: 09:30)');
            }
        }

        function addCustomSlot() {
            if (!selectedDateStr) {
                alert('Por favor seleccione una fecha primero');
                return;
            }

            const newTime = prompt('Ingrese el horario (formato HH:MM):');
            
            if (newTime && /^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/.test(newTime)) {
                if (!availabilityData[selectedDateStr]) {
                    availabilityData[selectedDateStr] = [];
                }
                
                // Verificar que no exista otro horario igual
                const exists = availabilityData[selectedDateStr].some(s => s.time === newTime);
                if (exists) {
                    alert('Ya existe un horario con esa hora');
                    return;
                }
                
                availabilityData[selectedDateStr].push({
                    time: newTime,
                    available: true
                });
                
                // Reordenar los horarios
                availabilityData[selectedDateStr].sort((a, b) => a.time.localeCompare(b.time));
                displayTimeSlots();
                generateCalendar();
            } else if (newTime) {
                alert('Formato de hora inv√°lido. Use HH:MM (ejemplo: 09:30)');
            }
        }

        function clearAllSlots() {
            if (!selectedDateStr) {
                alert('Por favor seleccione una fecha primero');
                return;
            }

            if (confirm('¬øEst√° seguro de que desea eliminar todos los horarios de esta fecha?')) {
                delete availabilityData[selectedDateStr];
                displayTimeSlots();
                generateCalendar();
            }
        }

        // Initialize the application
        initCalendar();
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'98ca211384c34a44',t:'MTc2MDE0MTM3MS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
