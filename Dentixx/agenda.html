<!DOCTYPE html>
<html lang="es" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agenda de citas</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            box-sizing: border-box;
        }
        .appointment-slot {
            transition: all 0.2s ease;
        }
        .appointment-slot:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        .confirmed-appointment {
            background: linear-gradient(135deg, #10b981, #059669);
        }
        .pending-appointment {
            background: linear-gradient(135deg, #f59e0b, #d97706);
        }
        .cancelled-appointment {
            background: linear-gradient(135deg, #ef4444, #dc2626);
        }
    </style>
</head>
<body class="h-full bg-gradient-to-br from-blue-50 to-indigo-100 font-sans">
    <div class="min-h-full p-6">
        <!-- Header -->
        <div class="max-w-7xl mx-auto mb-8">
            <div class="bg-white rounded-2xl shadow-lg p-6 border border-blue-100">
                <div class="flex items-center justify-between">
                    <div>
                        <h1 class="text-3xl font-bold text-gray-800 mb-2">Agenda de Citas</h1>
                        <p class="text-gray-600">Visualice y gestione todas las citas registradas y confirmadas</p>
                    </div>
                    <div class="text-right">
                        <div class="text-sm text-gray-500">Fecha actual</div>
                        <div class="text-lg font-semibold text-blue-600" id="currentDate"></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="max-w-7xl mx-auto grid grid-cols-1 lg:grid-cols-4 gap-6">
            <!-- Calendar Section -->
            <div class="lg:col-span-3">
                <div class="bg-white rounded-2xl shadow-lg p-6 border border-blue-100">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-xl font-bold text-gray-800">üìÖ Calendario de Citas</h2>
                        <div class="flex items-center space-x-4">
                            <button onclick="previousMonth()" class="p-2 rounded-lg bg-blue-100 hover:bg-blue-200 text-blue-600 transition-colors">
                                ‚Üê
                            </button>
                            <span class="font-semibold text-gray-700" id="monthYear"></span>
                            <button onclick="nextMonth()" class="p-2 rounded-lg bg-blue-100 hover:bg-blue-200 text-blue-600 transition-colors">
                                ‚Üí
                            </button>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-7 gap-2 mb-4">
                        <div class="text-center font-semibold text-gray-600 py-2">Dom</div>
                        <div class="text-center font-semibold text-gray-600 py-2">Lun</div>
                        <div class="text-center font-semibold text-gray-600 py-2">Mar</div>
                        <div class="text-center font-semibold text-gray-600 py-2">Mi√©</div>
                        <div class="text-center font-semibold text-gray-600 py-2">Jue</div>
                        <div class="text-center font-semibold text-gray-600 py-2">Vie</div>
                        <div class="text-center font-semibold text-gray-600 py-2">S√°b</div>
                    </div>
                    
                    <div class="grid grid-cols-7 gap-2" id="calendarGrid">
                        <!-- Calendar days will be generated here -->
                    </div>
                </div>
            </div>

            <!-- Statistics and Info Panel -->
            <div class="space-y-6">
                <!-- Monthly Summary -->
                <div class="bg-white rounded-2xl shadow-lg p-4 border border-blue-100">
                    <h3 class="text-lg font-bold text-gray-800 mb-3">üìä Resumen del Mes</h3>
                    
                    <div class="space-y-3">
                        <div class="flex items-center justify-between p-3 bg-blue-50 rounded-lg border border-blue-200">
                            <div class="flex items-center space-x-2">
                                <div class="w-3 h-3 bg-blue-500 rounded-full"></div>
                                <span class="text-sm font-medium text-blue-800">Citas Confirmadas</span>
                            </div>
                            <span class="font-bold text-blue-600" id="confirmedCount">0</span>
                        </div>
                    </div>
                </div>

                <!-- Today's Appointments -->
                <div class="bg-white rounded-2xl shadow-lg p-4 border border-blue-100">
                    <h3 class="text-lg font-bold text-gray-800 mb-3">üìã Citas de Hoy</h3>
                    <div id="todayAppointments" class="space-y-2">
                        <!-- Today's appointments will be shown here -->
                    </div>
                </div>
            
            </div>
        </div>
    </div>

    <script>
        let currentDate = new Date();
        let appointmentsData = {};

        // Sample appointments data - Only confirmed appointments
        function initSampleData() {
            const today = new Date();
            const currentMonth = today.getMonth();
            const currentYear = today.getFullYear();

            // Generate sample appointments for the current month (only confirmed)
            const sampleAppointments = [
                {
                    date: new Date(currentYear, currentMonth, 5),
                    time: '09:00',
                    patient: 'Mar√≠a Gonz√°lez',
                    treatment: 'Limpieza dental',
                    phone: '555-0123',
                    status: 'confirmed'
                },
                {
                    date: new Date(currentYear, currentMonth, 5),
                    time: '10:30',
                    patient: 'Carlos Rodr√≠guez',
                    treatment: 'Empaste',
                    phone: '555-0124',
                    status: 'confirmed'
                },
                {
                    date: new Date(currentYear, currentMonth, 8),
                    time: '14:00',
                    patient: 'Ana Mart√≠nez',
                    treatment: 'Ortodoncia - Revisi√≥n',
                    phone: '555-0125',
                    status: 'confirmed'
                },
                {
                    date: new Date(currentYear, currentMonth, 8),
                    time: '15:30',
                    patient: 'Luis P√©rez',
                    treatment: 'Extracci√≥n',
                    phone: '555-0126',
                    status: 'confirmed'
                },
                {
                    date: new Date(currentYear, currentMonth, 12),
                    time: '11:00',
                    patient: 'Carmen L√≥pez',
                    treatment: 'Blanqueamiento',
                    phone: '555-0127',
                    status: 'confirmed'
                },
                {
                    date: new Date(currentYear, currentMonth, 15),
                    time: '16:00',
                    patient: 'Roberto Silva',
                    treatment: 'Implante dental',
                    phone: '555-0128',
                    status: 'confirmed'
                },
                {
                    date: new Date(currentYear, currentMonth, 18),
                    time: '09:30',
                    patient: 'Elena Vargas',
                    treatment: 'Endodoncia',
                    phone: '555-0129',
                    status: 'confirmed'
                },
                {
                    date: new Date(currentYear, currentMonth, 22),
                    time: '13:00',
                    patient: 'Miguel Torres',
                    treatment: 'Pr√≥tesis dental',
                    phone: '555-0130',
                    status: 'confirmed'
                },
                {
                    date: today,
                    time: '10:00',
                    patient: 'Patricia Ruiz',
                    treatment: 'Consulta general',
                    phone: '555-0131',
                    status: 'confirmed'
                },
                {
                    date: today,
                    time: '15:00',
                    patient: 'Fernando Castro',
                    treatment: 'Limpieza dental',
                    phone: '555-0132',
                    status: 'confirmed'
                }
            ];

            // Organize appointments by date
            sampleAppointments.forEach(appointment => {
                const dateStr = appointment.date.toISOString().split('T')[0];
                if (!appointmentsData[dateStr]) {
                    appointmentsData[dateStr] = [];
                }
                appointmentsData[dateStr].push(appointment);
            });

            // Sort appointments by time for each date
            Object.keys(appointmentsData).forEach(dateStr => {
                appointmentsData[dateStr].sort((a, b) => a.time.localeCompare(b.time));
            });
        }

        // Initialize the calendar
        function initCalendar() {
            initSampleData();
            updateCurrentDate();
            generateCalendar();
            updateStatistics();
            showTodayAppointments();
        }

        function updateCurrentDate() {
            const today = new Date();
            document.getElementById('currentDate').textContent = today.toLocaleDateString('es-ES', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }

        function generateCalendar() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            
            document.getElementById('monthYear').textContent = currentDate.toLocaleDateString('es-ES', {
                month: 'long',
                year: 'numeric'
            });

            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const startDate = new Date(firstDay);
            startDate.setDate(startDate.getDate() - firstDay.getDay());

            const calendarGrid = document.getElementById('calendarGrid');
            calendarGrid.innerHTML = '';

            for (let i = 0; i < 42; i++) {
                const date = new Date(startDate);
                date.setDate(startDate.getDate() + i);
                
                const dayElement = document.createElement('div');
                const dateStr = date.toISOString().split('T')[0];
                const isCurrentMonth = date.getMonth() === month;
                const isToday = date.toDateString() === new Date().toDateString();
                const hasAppointments = appointmentsData[dateStr] && appointmentsData[dateStr].length > 0;
                
                dayElement.className = `
                    p-2 cursor-pointer rounded-lg transition-all hover:scale-105 min-h-32 border
                    ${isCurrentMonth ? 'text-gray-800 bg-white border-gray-200' : 'text-gray-400 bg-gray-50 border-gray-100'}
                    ${isToday ? 'border-blue-600 border-2 bg-blue-50' : ''}
                    ${hasAppointments ? 'border-green-400' : ''}
                `;
                
                // Day number
                const dayNumber = document.createElement('div');
                dayNumber.className = `text-sm font-semibold mb-1 ${isToday ? 'text-blue-600' : ''}`;
                dayNumber.textContent = date.getDate();
                dayElement.appendChild(dayNumber);
                
                // Appointments display
                if (hasAppointments) {
                    const appointments = appointmentsData[dateStr];
                    const appointmentsContainer = document.createElement('div');
                    appointmentsContainer.className = 'space-y-1';
                    
                    // Show first few appointments
                    const visibleAppointments = appointments.slice(0, 3);
                    visibleAppointments.forEach((appointment, index) => {
                        const appointmentElement = document.createElement('div');
                        let bgColor = 'bg-blue-500 hover:bg-blue-600';
                        let statusIcon = '';
                        
                        if (appointment.status === 'completed') {
                            bgColor = 'bg-green-500 hover:bg-green-600';
                            statusIcon = '‚úÖ ';
                        } else if (appointment.status === 'absent') {
                            bgColor = 'bg-yellow-500 hover:bg-yellow-600';
                            statusIcon = 'üëª ';
                        }
                        
                        appointmentElement.className = `text-xs px-1 py-0.5 rounded cursor-pointer transition-colors ${bgColor} text-white`;
                        appointmentElement.textContent = `${statusIcon}${appointment.time} - ${appointment.patient.split(' ')[0]}`;
                        appointmentElement.onclick = (e) => {
                            e.stopPropagation();
                            openSingleAppointmentModal(appointment, dateStr, index);
                        };
                        appointmentsContainer.appendChild(appointmentElement);
                    });
                    
                    // Show count if more appointments exist
                    if (appointments.length > 3) {
                        const moreElement = document.createElement('div');
                        moreElement.className = 'text-xs text-gray-500 text-center cursor-pointer hover:text-gray-700';
                        moreElement.textContent = `+${appointments.length - 3} m√°s`;
                        moreElement.onclick = (e) => {
                            e.stopPropagation();
                            openAppointmentsModal(dateStr, date);
                        };
                        appointmentsContainer.appendChild(moreElement);
                    }
                    
                    dayElement.appendChild(appointmentsContainer);
                }
                
                dayElement.onclick = () => openAppointmentsModal(dateStr, date);
                calendarGrid.appendChild(dayElement);
            }
        }

        function getStatusClass(status) {
            switch(status) {
                case 'confirmed':
                    return 'bg-green-500 text-white hover:bg-green-600';
                case 'pending':
                    return 'bg-yellow-500 text-white hover:bg-yellow-600';
                case 'cancelled':
                    return 'bg-red-500 text-white hover:bg-red-600';
                default:
                    return 'bg-gray-500 text-white hover:bg-gray-600';
            }
        }

        function getStatusText(status) {
            switch(status) {
                case 'confirmed':
                    return '‚úÖ Confirmada';
                case 'pending':
                    return '‚è≥ Pendiente';
                case 'cancelled':
                    return '‚ùå Cancelada';
                default:
                    return '‚ùì Desconocido';
            }
        }

        function openSingleAppointmentModal(appointment, dateStr, appointmentIndex) {
            // Create modal backdrop
            const modalBackdrop = document.createElement('div');
            modalBackdrop.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modalBackdrop.onclick = (e) => {
                if (e.target === modalBackdrop) {
                    modalBackdrop.remove();
                }
            };

            // Create modal content
            const modalContent = document.createElement('div');
            modalContent.className = 'bg-white rounded-2xl shadow-2xl p-6 max-w-md w-full mx-4';
            
            const appointmentDate = new Date(dateStr);
            const dateFormatted = appointmentDate.toLocaleDateString('es-ES', {
                weekday: 'long',
                day: 'numeric',
                month: 'long',
                year: 'numeric'
            });

            modalContent.innerHTML = `
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-xl font-bold text-gray-800">üìã Informaci√≥n de Cita</h3>
                    <button onclick="this.closest('.fixed').remove()" class="text-gray-500 hover:text-gray-700 text-2xl">√ó</button>
                </div>
                
                <div class="mb-6">
                    <div class="p-4 rounded-lg border bg-blue-50 border-blue-300">
                        <div class="space-y-3 mb-4">
                            <div class="flex items-center space-x-2">
                                <span class="text-sm text-gray-600">üìÖ Fecha:</span>
                                <span class="font-semibold text-gray-800">${dateFormatted}</span>
                            </div>
                            <div class="flex items-center space-x-2">
                                <span class="text-sm text-gray-600">üïê Hora:</span>
                                <span class="font-bold text-lg text-gray-800">${appointment.time}</span>
                            </div>
                            <div class="flex items-center space-x-2">
                                <span class="text-sm text-gray-600">üë§ Paciente:</span>
                                <span class="font-semibold text-gray-800">${appointment.patient}</span>
                            </div>
                            <div class="flex items-center space-x-2">
                                <span class="text-sm text-gray-600">ü¶∑ Tratamiento:</span>
                                <span class="text-gray-800">${appointment.treatment}</span>
                            </div>
                            <div class="flex items-center space-x-2">
                                <span class="text-sm text-gray-600">üìû Tel√©fono:</span>
                                <span class="text-gray-800">${appointment.phone}</span>
                            </div>
                            <div class="flex items-center space-x-2">
                                <span class="text-sm text-gray-600">üìä Estado:</span>
                                <span class="font-medium ${appointment.status === 'completed' ? 'text-green-700' : appointment.status === 'absent' ? 'text-yellow-700' : 'text-blue-700'}">
                                    ${appointment.status === 'completed' ? '‚úÖ Completada' : appointment.status === 'absent' ? 'Ausente' : '‚úÖ Confirmada'}
                                </span>
                            </div>
                        </div>
                        
                        <div class="border-t border-blue-200 pt-4">
                            <p class="text-sm text-gray-600 mb-3">¬øQu√© acci√≥n desea realizar con esta cita?</p>
                            <div class="flex flex-col space-y-2">
                                ${appointment.status === 'confirmed' ? `
                                    <button onclick="updateAppointmentStatus('${dateStr}', ${appointmentIndex}, 'completed')" 
                                            class="w-full px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">
                                        ‚úÖ Marcar como Completada
                                    </button>
                                    <button onclick="updateAppointmentStatus('${dateStr}', ${appointmentIndex}, 'absent')" 
                                            class="w-full px-4 py-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 transition-colors">
                                        Marcar como Ausente
                                    </button>
                                    <button onclick="updateAppointmentStatus('${dateStr}', ${appointmentIndex}, 'cancelled')" 
                                            class="w-full px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors">
                                        ‚ùå Cancelar Cita
                                    </button>
                                ` : appointment.status === 'completed' ? `
                                    <div class="w-full px-4 py-2 bg-green-100 text-green-800 rounded-lg text-center">
                                        ‚úÖ Esta cita ya fue completada
                                    </div>
                                ` : appointment.status === 'absent' ? `
                                    <div class="w-full px-4 py-2 bg-yellow-100 text-yellow-800 rounded-lg text-center">
                                        Paciente marcado como ausente
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                </div>
            `;

            modalBackdrop.appendChild(modalContent);
            document.body.appendChild(modalBackdrop);
        }

        function openAppointmentsModal(dateStr, date) {
            // Create modal backdrop
            const modalBackdrop = document.createElement('div');
            modalBackdrop.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modalBackdrop.onclick = (e) => {
                if (e.target === modalBackdrop) {
                    modalBackdrop.remove();
                }
            };

            // Create modal content
            const modalContent = document.createElement('div');
            modalContent.className = 'bg-white rounded-2xl shadow-2xl p-6 max-w-2xl w-full mx-4 max-h-96 overflow-hidden';
            
            const dateFormatted = date.toLocaleDateString('es-ES', {
                weekday: 'long',
                day: 'numeric',
                month: 'long',
                year: 'numeric'
            });

            modalContent.innerHTML = `
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-xl font-bold text-gray-800">üìÖ Citas del ${dateFormatted}</h3>
                    <button onclick="this.closest('.fixed').remove()" class="text-gray-500 hover:text-gray-700 text-2xl">√ó</button>
                </div>
                
                <div class="mb-4">
                    <div id="modalAppointments" class="space-y-3 max-h-64 overflow-y-auto">
                        ${generateModalAppointments(dateStr)}
                    </div>
                </div>
            `;

            modalBackdrop.appendChild(modalContent);
            document.body.appendChild(modalBackdrop);
        }

        function generateModalAppointments(dateStr) {
            if (!appointmentsData[dateStr] || appointmentsData[dateStr].length === 0) {
                return '<div class="text-center text-gray-500 py-8">No hay citas programadas para esta fecha</div>';
            }

            const appointments = appointmentsData[dateStr];
            return appointments.map((appointment, index) => {
                let bgColor = 'bg-blue-50 border-blue-300';
                let statusText = '‚úÖ Confirmada';
                let statusColor = 'text-blue-700';
                
                if (appointment.status === 'completed') {
                    bgColor = 'bg-green-50 border-green-300';
                    statusText = '‚úÖ Completada';
                    statusColor = 'text-green-700';
                } else if (appointment.status === 'absent') {
                    bgColor = 'bg-yellow-50 border-yellow-300';
                    statusText = 'Ausente';
                    statusColor = 'text-yellow-700';
                }
                
                return `
                    <div class="p-4 rounded-lg border ${bgColor}" id="appointment-${dateStr}-${index}">
                        <div class="flex items-start justify-between">
                            <div class="flex-1">
                                <div class="flex items-center space-x-3 mb-2">
                                    <span class="font-bold text-lg text-gray-800">${appointment.time}</span>
                                    <span class="text-sm ${statusColor}">
                                        ${statusText}
                                    </span>
                                </div>
                                <div class="space-y-1 mb-3">
                                    <div class="flex items-center space-x-2">
                                        <span class="text-sm text-gray-600">üë§ Paciente:</span>
                                        <span class="font-semibold text-gray-800">${appointment.patient}</span>
                                    </div>
                                    <div class="flex items-center space-x-2">
                                        <span class="text-sm text-gray-600">ü¶∑ Tratamiento:</span>
                                        <span class="text-gray-800">${appointment.treatment}</span>
                                    </div>
                                    <div class="flex items-center space-x-2">
                                        <span class="text-sm text-gray-600">üìû Tel√©fono:</span>
                                        <span class="text-gray-800">${appointment.phone}</span>
                                    </div>
                                </div>
                                <div class="flex space-x-2">
                                    ${appointment.status === 'confirmed' ? `
                                        <button onclick="updateAppointmentStatus('${dateStr}', ${index}, 'completed')" 
                                                class="px-3 py-1 bg-green-600 text-white text-sm rounded-lg hover:bg-green-700 transition-colors">
                                            ‚úÖ Completar
                                        </button>
                                        <button onclick="updateAppointmentStatus('${dateStr}', ${index}, 'absent')" 
                                                class="px-3 py-1 bg-yellow-600 text-white text-sm rounded-lg hover:bg-yellow-700 transition-colors">
                                             Ausente
                                        </button>
                                        <button onclick="updateAppointmentStatus('${dateStr}', ${index}, 'cancelled')" 
                                                class="px-3 py-1 bg-red-600 text-white text-sm rounded-lg hover:bg-red-700 transition-colors">
                                            ‚ùå Cancelar
                                        </button>
                                    ` : appointment.status === 'completed' ? `
                                        <div class="px-3 py-1 bg-green-100 text-green-800 text-sm rounded-lg">
                                            ‚úÖ Completada
                                        </div>
                                    ` : appointment.status === 'absent' ? `
                                        <div class="px-3 py-1 bg-yellow-100 text-yellow-800 text-sm rounded-lg">
                                         Ausente
                                        </div>
                                    ` : ''}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function updateAppointmentStatus(dateStr, appointmentIndex, newStatus) {
            const appointment = appointmentsData[dateStr][appointmentIndex];
            const patientName = appointment.patient;
            
            let confirmMessage = '';
            switch(newStatus) {
                case 'completed':
                    confirmMessage = `¬øConfirmar que la cita de ${patientName} fue completada exitosamente?`;
                    break;
                case 'absent':
                    confirmMessage = `¬øMarcar a ${patientName} como ausente a su cita?`;
                    break;
                case 'cancelled':
                    confirmMessage = `¬øConfirmar la cancelaci√≥n de la cita de ${patientName}?`;
                    break;
            }
            
            // Create custom confirmation modal
            const confirmModal = document.createElement('div');
            confirmModal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            
            confirmModal.innerHTML = `
                <div class="bg-white rounded-2xl shadow-2xl p-6 max-w-md w-full mx-4">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">Confirmar Acci√≥n</h3>
                    <p class="text-gray-600 mb-6">${confirmMessage}</p>
                    <div class="flex space-x-3 justify-end">
                        <button onclick="this.closest('.fixed').remove()" 
                                class="px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 transition-colors">
                            Cancelar
                        </button>
                        <button onclick="confirmStatusUpdate('${dateStr}', ${appointmentIndex}, '${newStatus}'); this.closest('.fixed').remove()" 
                                class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                            Confirmar
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(confirmModal);
        }

        function confirmStatusUpdate(dateStr, appointmentIndex, newStatus) {
            if (newStatus === 'cancelled') {
                // Remove the appointment from confirmed appointments only if cancelled
                appointmentsData[dateStr].splice(appointmentIndex, 1);
                
                // If no more appointments for this date, remove the date entry
                if (appointmentsData[dateStr].length === 0) {
                    delete appointmentsData[dateStr];
                }
            } else {
                // Update the appointment status for completed and absent
                appointmentsData[dateStr][appointmentIndex].status = newStatus;
            }
            
            // Refresh the modal content
            const modalSlotsContainer = document.getElementById('modalAppointments');
            if (modalSlotsContainer) {
                modalSlotsContainer.innerHTML = generateModalAppointments(dateStr);
            }
            
            // Refresh calendar and statistics
            generateCalendar();
            updateStatistics();
            showTodayAppointments();
            
            // Show success message
            showSuccessMessage(newStatus);
        }

        function showSuccessMessage(status) {
            const messages = {
                'completed': '‚úÖ Cita marcada como completada',
                'absent': ' Paciente marcado como ausente',
                'cancelled': '‚ùå Cita cancelada exitosamente'
            };
            
            const toast = document.createElement('div');
            toast.className = 'fixed top-4 right-4 bg-green-600 text-white px-6 py-3 rounded-lg shadow-lg z-50 transform translate-x-full transition-transform';
            toast.textContent = messages[status];
            
            document.body.appendChild(toast);
            
            // Animate in
            setTimeout(() => {
                toast.classList.remove('translate-x-full');
            }, 100);
            
            // Remove after 3 seconds
            setTimeout(() => {
                toast.classList.add('translate-x-full');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        function updateStatistics() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            
            let confirmed = 0;
            
            Object.keys(appointmentsData).forEach(dateStr => {
                const date = new Date(dateStr);
                if (date.getFullYear() === year && date.getMonth() === month) {
                    confirmed += appointmentsData[dateStr].length;
                }
            });
            
            document.getElementById('confirmedCount').textContent = confirmed;
        }

        function showTodayAppointments() {
            const today = new Date();
            const todayStr = today.toISOString().split('T')[0];
            const todayAppointments = appointmentsData[todayStr] || [];
            
            const container = document.getElementById('todayAppointments');
            
            if (todayAppointments.length === 0) {
                container.innerHTML = '<div class="text-center text-gray-500 py-4">No hay citas para hoy</div>';
                return;
            }
            
            container.innerHTML = todayAppointments.map((appointment, index) => {
                let bgColor = 'bg-blue-500 hover:bg-blue-600';
                let statusIcon = '';
                
                if (appointment.status === 'completed') {
                    bgColor = 'bg-green-500 hover:bg-green-600';
                    statusIcon = '‚úÖ ';
                } else if (appointment.status === 'absent') {
                    bgColor = 'bg-yellow-500 hover:bg-yellow-600';
                    statusIcon = 'üëª ';
                }
                
                return `
                    <div class="p-2 rounded-lg ${bgColor} text-white text-xs cursor-pointer transition-colors" 
                         onclick="openSingleAppointmentModal(appointmentsData['${todayStr}'][${index}], '${todayStr}', ${index})">
                        <div class="font-semibold">${statusIcon}${appointment.time} - ${appointment.patient.split(' ')[0]}</div>
                        <div class="opacity-90">${appointment.treatment}</div>
                    </div>
                `;
            }).join('');
        }

        function previousMonth() {
            currentDate.setMonth(currentDate.getMonth() - 1);
            generateCalendar();
            updateStatistics();
        }

        function nextMonth() {
            currentDate.setMonth(currentDate.getMonth() + 1);
            generateCalendar();
            updateStatistics();
        }

        // Initialize the application
        initCalendar();
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'99144adf90ff55c3',t:'MTc2MDkxOTAyOS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
